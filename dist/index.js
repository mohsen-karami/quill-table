function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,o,l,n,i=[],s=!0,d=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(a=l.call(r)).done)&&(i.push(a.value),i.length!==t);s=!0);}catch(e){d=!0,o=e}finally{try{if(!s&&null!=r.return&&(n=r.return(),Object(n)!==n))return}finally{if(d)throw o}}return i}}(e,r)||t(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){if(e){if("string"==typeof e)return r(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,l=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",d=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function h(e,t,r,a){var o=t&&t.prototype instanceof g?t:g,n=Object.create(o.prototype),i=new A(a||[]);return l(n,"_invoke",{value:E(e,r,i)}),n}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="suspendedYield",v="executing",b="completed",f={};function g(){}function w(){}function y(){}var N={};c(N,i,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(M([])));C&&C!==r&&o.call(C,i)&&(N=C);var T=y.prototype=g.prototype=Object.create(N);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(a,l,n,i){var s=u(e[a],e,l);if("throw"!==s.type){var d=s.arg,c=d.value;return c&&"object"==typeof c&&o.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,n,i)}),(function(e){r("throw",e,n,i)})):t.resolve(c).then((function(e){d.value=e,n(d)}),(function(e){return r("throw",e,n,i)}))}i(s.arg)}var a;l(this,"_invoke",{value:function(e,o){function l(){return new t((function(t,a){r(e,o,t,a)}))}return a=a?a.then(l,l):l()}})}function E(t,r,a){var o=p;return function(l,n){if(o===v)throw new Error("Generator is already running");if(o===b){if("throw"===l)throw n;return{value:e,done:!0}}for(a.method=l,a.arg=n;;){var i=a.delegate;if(i){var s=S(i,a);if(s){if(s===f)continue;return s}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===p)throw o=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=v;var d=u(t,r,a);if("normal"===d.type){if(o=a.done?b:m,d.arg===f)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o=b,a.method="throw",a.arg=d.arg)}}}function S(t,r){var a=r.method,o=t.iterator[a];if(o===e)return r.delegate=null,"throw"===a&&t.iterator.return&&(r.method="return",r.arg=e,S(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),f;var l=u(o,t.iterator,r.arg);if("throw"===l.type)return r.method="throw",r.arg=l.arg,r.delegate=null,f;var n=l.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function q(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(q,this),this.reset(!0)}function M(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,l=function r(){for(;++a<t.length;)if(o.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return l.next=l}}throw new TypeError(typeof t+" is not iterable")}return w.prototype=y,l(T,"constructor",{value:y,configurable:!0}),l(y,"constructor",{value:w,configurable:!0}),w.displayName=c(y,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,d,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},x(L.prototype),c(L.prototype,s,(function(){return this})),t.AsyncIterator=L,t.async=function(e,r,a,o,l){void 0===l&&(l=Promise);var n=new L(h(e,r,a,o),l);return t.isGeneratorFunction(r)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},x(T),c(T,d,"Generator"),c(T,i,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(a,o){return i.type="throw",i.arg=t,r.next=a,o&&(r.method="next",r.arg=e),!!o}for(var l=this.tryEntries.length-1;l>=0;--l){var n=this.tryEntries[l],i=n.completion;if("root"===n.tryLoc)return a("end");if(n.tryLoc<=this.prev){var s=o.call(n,"catchLoc"),d=o.call(n,"finallyLoc");if(s&&d){if(this.prev<n.catchLoc)return a(n.catchLoc,!0);if(this.prev<n.finallyLoc)return a(n.finallyLoc)}else if(s){if(this.prev<n.catchLoc)return a(n.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return a(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var l=a;break}}l&&("break"===e||"continue"===e)&&l.tryLoc<=t&&t<=l.finallyLoc&&(l=null);var n=l?l.completion:{};return n.type=e,n.arg=t,l?(this.method="next",this.next=l.finallyLoc,f):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),B(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var o=a.arg;B(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:M(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),f}},t}function o(e,t,r,a,o,l,n){try{var i=e[l](n),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(a,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(a,l){var n=e.apply(t,r);function i(e){o(n,a,l,i,s,"next",e)}function s(e){o(n,a,l,i,s,"throw",e)}i(void 0)}))}}import n from"quill";var i="contain",s="tableWrapper",d="table",c="colgroup",h="col",u="tbody",p="tr",m="td",v="tableCellInner",b="table",f="table",g=n.import("blots/container"),w=n.import("parchment");class y extends g{static create(e){var t=super.create();return t.dataset.tableId=e,t.addEventListener("dragstart",(e=>{e.preventDefault(),e.stopPropagation()}),!0),t.ondrop=e=>{e.preventDefault()},t.ondragover=e=>{e.preventDefault(),e.dataTransfer.dropEffect="none"},t}get tableId(){return this.domNode.dataset.tableId}insertBefore(e,t){e.statics.blotName==this.statics.blotName?super.insertBefore(e.children.head,t):this.statics.allowedChildren.find((t=>t.blotName===e.statics.blotName))?super.insertBefore(e,t):t?this.prev?this.prev.insertBefore(e,null):this.parent.insertBefore(e,this):this.next?this.next.insertBefore(e,t):this.parent.appendChild(e)}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&e.domNode.dataset.tableId===this.domNode.dataset.tableId&&(e.moveChildren(this),e.remove())}deleteAt(e,t){var r;super.deleteAt(e,t),null===(r=document.querySelector('.ql-table-tooltip[data-table-id="'.concat(this.tableId,'"]')))||void 0===r||null===(r=r.classList)||void 0===r||r.add("ql-hidden")}}y.blotName=s,y.tagName="p",y.className="ql-table-wrapper",y.scope=w.Scope.BLOCK_BLOT;var N="createTable",I=()=>Math.random().toString(36).slice(2),C=8e3,T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.child,r=e.target,a=void 0===r?document.body:r,o=e.beforeClose,l=void 0===o?()=>{}:o,n=a,i=document.createElement("div");i.classList.add("dialog"),i.style.zIndex=C;var s=document.createElement("div");if(s.classList.add("dialog_overlay"),i.appendChild(s),t){var d=document.createElement("div");d.classList.add("dialog_content"),d.appendChild(t),s.appendChild(d),d.onclick=e=>{e.stopPropagation()}}var c=getComputedStyle(n).overflow;n.style.overflow="hidden",n.appendChild(i);var h=()=>{l(),i.remove(),n.style.overflow=c};return i.onclick=h,C+=1,{dialog:i,close:h}},x=(e,t)=>{t.type||(t.type="text"),t.value||(t.value="");var r=document.createElement("div");if(r.classList.add("input_item"),e){var a=document.createElement("span");a.classList.add("input_label"),a.innerText=e,r.appendChild(a)}var o=document.createElement("div");o.classList.add("input_input");var l=document.createElement("input");for(var n in t)l.setAttribute(n,t[n]);(t.max||t.min)&&l.addEventListener("blur",(()=>{t.max&&t.max<=l.value&&(l.value=t.max),t.min&&t.min>=l.value&&(l.value=t.min)})),o.appendChild(l),r.appendChild(o),l.onfocus=()=>{o.classList.add("focus")},l.onblur=()=>{o.classList.remove("focus")};var i=e=>{if(o.classList.contains("error"))o.querySelector(".error_tip").innerText=e;else{var t=document.createElement("span");t.classList.add("error_tip"),t.innerText=e,o.appendChild(t)}o.classList.add("error");return{removeError:()=>{o.classList.remove("error"),i.remove()}}};return{item:r,input:l,errorTip:i}},L=function(){var e=l(a().mark((function e(){var t,r,o,n,i,s,d,c,h,u,p,m,v,b,f,g=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.length>0&&void 0!==g[0]?g[0]:3,r=g.length>1&&void 0!==g[1]?g[1]:3,(o=document.createElement("div")).classList.add("create_box"),(n=document.createElement("div")).classList.add("create_input_content"),i=x("row",{type:"number",value:t,max:99}),s=i.item,d=i.input,c=i.errorTip,h=x("col",{type:"number",value:r,max:99}),u=h.item,p=h.input,m=h.errorTip,n.appendChild(s),n.appendChild(u),o.appendChild(n),(v=document.createElement("div")).classList.add("create_control"),(b=document.createElement("button")).classList.add("create_control_btn","confirm"),b.innerText="Confirm",(f=document.createElement("button")).classList.add("create_control_btn","cancel"),f.innerText="Cancel",v.appendChild(b),v.appendChild(f),o.appendChild(v),e.abrupt("return",new Promise(((e,t)=>{var r=T({child:o,beforeClose:t}).close;b.onclick=l(a().mark((function t(){var o,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Number(d.value),l=Number(p.value),!(isNaN(o)||o<=0)){t.next=4;break}return t.abrupt("return",c("Invalid number"));case 4:if(!(isNaN(l)||l<=0)){t.next=6;break}return t.abrupt("return",m("Invalid number"));case 6:e({row:o,col:l}),r();case 8:case"end":return t.stop()}}),t)}))),f.onclick=()=>{r()}})));case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function E(e,t){if("object"==typeof t)for(var r in t)e.style[r]=t[r]}function S(e,t){var r=t.getBoundingClientRect();return{x:e.x-r.x-t.scrollLeft,y:e.y-r.y-t.scrollTop,x1:e.x-r.x-t.scrollLeft+e.width,y1:e.y-r.y-t.scrollTop+e.height,width:e.width,height:e.height}}function q(e,t){var r=Math.min(e.x,t.x,e.x+e.width-1,t.x+t.width-1),a=Math.max(e.x,t.x,e.x+e.width-1,t.x+t.width-1),o=Math.min(e.y,t.y,e.y+e.height-1,t.y+t.height-1),l=Math.max(e.y,t.y,e.y+e.height-1,t.y+t.height-1);return{x:r,x1:a,y:o,y1:l,width:a-r,height:l-o}}function B(e){return"function"==typeof e}var A=12;class M{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.quill=e,this.options=t,this.optionsMerge(),this.tableWrapper=null,this.table=null,this.curTableId="",this.focusTableChange=!1,this.tableCols=[],this.scrollHandler=[],this.tableDisableToolHandlers={},this.root=this.quill.addContainer("ql-table-tooltip"),this.root.style.height=A+"px",new ResizeObserver((e=>{this.hide(),this.curTableId=""})).observe(this.quill.root),this.isMobile="ontouchstart"in window,this.handledEvents=this.isMobile?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"},this.hide(),this.listen()}optionsMerge(){var e,t;(null===(e=this.options)||void 0===e?void 0:e.tipHeight)&&(A=this.options.tipHeight),M.disableToolNames=Array.from(new Set([...M.disableToolNames,...(null===(t=this.options)||void 0===t?void 0:t.disableToolNames)||[]]))}listen(){this.quill.on(n.events.SELECTION_CHANGE,((t,r,a)=>{if(null!=t){if(0===t.length){var o=e(this.quill.scroll.descendant(y,t.index),2),l=o[0];o[1];if(null!==l){var n;this.disableFromTable(),this.tableWrapper=l,this.table=l.children.head;for(var i=l.children.tail;i&&i.statics.blotName!==u;){var s;i=null===(s=i.children)||void 0===s?void 0:s.tail}var d=null===(n=l.children.head)||void 0===n||null===(n=n.children)||void 0===n?void 0:n.head;d.statics.blotName===c&&d.children.length?this.tableCols=d.children.map((e=>e)):this.tableCols=[];var h=l.children.head.tableId;this.curTableId!==h&&(this.clearScrollEvent(),this.focusTableChange=!0,this.addScrollEvent(this.tableWrapper.domNode,this.scrollSync.bind(this,this.tableWrapper.domNode))),this.curTableId=h,this.show();var p=S(this.tableWrapper.domNode.getBoundingClientRect(),this.quill.container);return p.top=p.y,p.left=p.x,void this.position(p)}}this.hide()}}))}disableFromTable(){this.toggleDisableToolbarTools("add");var e=this.quill.getModule("toolbar");if(!e.disableByTable){e.disableByTable=!0;var r,a=function(e,r){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=t(e))||r&&e&&"number"==typeof e.length){a&&(e=a);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){s=!0,n=e},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw n}}}}(M.disableToolNames);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.tableDisableToolHandlers[o]=e.handlers[o],e.handlers[o]=()=>{}}}catch(e){a.e(e)}finally{a.f()}}}enableFromTable(){this.toggleDisableToolbarTools("remove");var e=this.quill.getModule("toolbar");for(var t in this.tableDisableToolHandlers)e.handlers[t]=this.tableDisableToolHandlers[t];this.tableDisableToolHandlers={},e.disableByTable=!1}toggleDisableToolbarTools(t){this.quill.getModule("toolbar").controls.map((r=>{var a=e(r,2),o=a[0],l=a[1];M.disableToolNames.includes(o)&&("select"===l.tagName.toLowerCase()?document.querySelector(".ql-select.".concat(l.className)).classList[t]("ql-disabled-table"):l.classList[t]("ql-disabled-table"))}))}scrollSync(e,t){this.root.scrollLeft=e.scrollLeft}addScrollEvent(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}clearScrollEvent(){for(var t=0;t<this.scrollHandler.length;t++){var r=e(this.scrollHandler[t],2),a=r[0],o=r[1];a.removeEventListener("scroll",o)}this.scrollHandler=[]}position(e){E(this.root,{top:"".concat(e.top+this.quill.container.scrollTop-A,"px"),left:"".concat(16,"px")})}show(){if(this.tableCols.length){if(this.focusTableChange){var e=this.tableWrapper.domNode.getBoundingClientRect();this.root.dataset.tableId=this.tableWrapper.tableId,this.root.innerHTML=[...this.tableCols].map((t=>'<div class="ql-table-col-header" style="width: '.concat(t.width,'px">\n            \t\t\t<div class="ql-table-col-separator" style="height: ').concat(e.height+A-3,'px"></div>\n            \t\t</div>'))).join(""),this.focusTableChange=!1,this.bindDrag()}setTimeout((()=>{this.scrollSync(this.tableWrapper.domNode)}),0),this.root.classList.remove("ql-hidden")}}hide(){this.root.classList.add("ql-hidden"),this.enableFromTable()}bindDrag(){var e=null,t=-1,r=Array.from(this.root.getElementsByClassName("ql-table-col-header")),a=Array.from(this.root.getElementsByClassName("ql-table-col-separator")),o=document.body,l=a=>{var o=r[t].getBoundingClientRect(),l=this.isMobile?a.changedTouches[0].pageX:a.pageX;l-o.x<26&&(l=o.x+26),l=Math.floor(l),e.style.left=l+"px",e.dataset.w=l-o.x},n=a=>{var i=parseInt(e.dataset.w);this.table.domNode.style.width=parseFloat(this.table.domNode.style.width)-parseFloat(r[t].style.width)+i+"px",r[t].style.width=i+"px",this.tableCols[t].width=i,o.removeChild(e),e=null,t=-1,document.removeEventListener(this.handledEvents.up,n),document.removeEventListener(this.handledEvents.move,l),this.quill.getModule(f).hideTableTools()},i=(r,a)=>{document.addEventListener(this.handledEvents.up,n),document.addEventListener(this.handledEvents.move,l),t=r;var i=document.createElement("div");i.classList.add("ql-table-drag-line");var s=this.tableWrapper.domNode.getBoundingClientRect();E(i,{top:"".concat(s.y-A,"px"),left:"".concat(this.isMobile?a.changedTouches[0].pageX:a.pageX,"px"),height:"".concat(s.height+A,"px")}),o.appendChild(i),e&&o.removeChild(e),e=i};a.map(((e,t)=>{e.addEventListener(this.handledEvents.down,i.bind(this,t)),e.addEventListener("dragstart",(e=>{e.preventDefault()}))}))}}M.disableToolNames=[f];var _=n.import("blots/container"),k=n.import("parchment");class O extends _{static create(e){return super.create("contain")}insertBefore(e,t){e.statics.blotName==this.statics.blotName?super.insertBefore(e.children.head,t):super.insertBefore(e,t)}format(e,t){this.domNode.lastChild.setAttribute(e,t)}formats(){return{[this.statics.blotName]:this.statics.formats(this.domNode)}}replace(e){if(e.statics.blotName!==this.statics.blotName){var t=k.create(this.statics.defaultChild);e.moveChildren(t),this.appendChild(t)}null!=e.parent&&super.replace(e)}}O.blotName=i,O.tagName="contain",O.scope=k.Scope.BLOCK_BLOT,O.defaultChild="block";var H=n.import("parchment");class R extends O{static create(e){var t=e.tableId,r=e.rowId,a=e.colId,o=e.rowspan,l=e.colspan,n=e.style,i=super.create();return i.dataset.tableId=t,i.dataset.rowId=r,i.dataset.colId=a,i.dataset.rowspan=o||1,i.dataset.colspan=l||1,i._style=n,i}formats(){var e=this.domNode.dataset,t=e.tableId,r=e.rowId,a=e.colId,o=e.rowspan,l=e.colspan;return{[this.statics.blotName]:{tableId:t,rowId:r,colId:a,rowspan:o,colspan:l,style:this.domNode._style}}}updateDelta(){this.children.forEach((e=>{e.cache={}}))}get rowId(){return this.domNode.dataset.rowId}get colId(){return this.domNode.dataset.colId}get rowspan(){return Number(this.domNode.dataset.rowspan)}set rowspan(e){this.parent&&(this.parent.rowspan=e),this.domNode.dataset.rowspan=e,this.updateDelta()}get colspan(){return Number(this.domNode.dataset.colspan)}set colspan(e){this.parent&&(this.parent.colspan=e),this.domNode.dataset.colspan=e,this.updateDelta()}set style(e){this.domNode._style=e,this.parent.style=e,this.updateDelta()}optimize(){super.optimize();var e=this.parent,t=this.domNode.dataset,r=t.tableId,a=t.colId,o=t.rowId,l=t.rowspan,n=t.colspan;if(null!=e&&e.statics.blotName!=m){var i=H.create("block");this.parent.insertBefore(i,this.next);var c=H.create(s,r),h=H.create(d,r),v=H.create(u),b=H.create(p,o),f=H.create(m,{tableId:r,rowId:o,colId:a,rowspan:l,colspan:n,style:this.domNode._style});f.appendChild(this),b.appendChild(f),v.appendChild(b),h.appendChild(v),c.appendChild(h),c.replace(i)}var g=this.next;null!=g&&g.prev===this&&g.statics.blotName===this.statics.blotName&&(g.moveChildren(this),g.remove())}}R.blotName=v,R.tagName="p",R.className="ql-table-cell-inner",R.scope=H.Scope.BLOCK_BLOT;var j=n.import("parchment"),D=n.import("blots/container");class z extends D{static create(e){var t=e.rowId,r=e.colId,a=e.rowspan,o=e.colspan,l=e.style,n=super.create();return n.dataset.rowId=t,n.dataset.colId=r,n.setAttribute("rowspan",a||1),n.setAttribute("colspan",o||1),n.setAttribute("style",l||""),n}get rowId(){return this.domNode.dataset.rowId}get colId(){return this.domNode.dataset.colId}get rowspan(){return Number(this.domNode.getAttribute("rowspan"))}set rowspan(e){this.domNode.setAttribute("rowspan",e)}get colspan(){return Number(this.domNode.getAttribute("colspan"))}set colspan(e){this.domNode.setAttribute("colspan",e)}set style(e){this.domNode.setAttribute("style",e)}getCellInner(){return this.descendants(R)[0]}optimize(){super.optimize();var e=this.domNode.dataset,t=e.colId,r=e.rowId,a=this.next;null!=a&&a.prev===this&&a.statics.blotName===this.statics.blotName&&a.domNode.dataset.rowId===r&&a.domNode.dataset.colId===t&&(a.moveChildren(this),a.remove())}deleteAt(e,t){if(0===e&&t===this.length()){var r=this.next||this.prev,a=r&&r.getCellInner();return a&&(a.colspan+=this.colspan),this.remove()}this.children.forEachAt(e,t,(function(e,t,r){e.deleteAt(t,r)}))}}z.blotName=m,z.tagName="td",z.className="ql-table-cell",z.scope=j.Scope.BLOCK_BLOT;var P="#0589f3";class W{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return null;this.table=e,this.quill=t,this.options=r,this.optionsMerge(),this.boundary={},this.selectedTds=[],this.dragging=!1,this.selectingHandler=this.mouseDownHandler.bind(this),this.cellSelect=null,this.scrollHandler=[],this.helpLinesInitial(),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.closeHandler=e=>{e.ops.find((e=>!!e.insert))&&this.clearSelection()},this.quill.on(n.events.TEXT_CHANGE,this.closeHandler)}optionsMerge(){var e;(null===(e=this.options)||void 0===e?void 0:e.primaryColor)&&(P=this.options.primaryColor)}addScrollEvent(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}clearScrollEvent(){for(var t=0;t<this.scrollHandler.length;t++){var r=e(this.scrollHandler[t],2),a=r[0],o=r[1];a.removeEventListener("scroll",o)}this.scrollHandler=[]}helpLinesInitial(){var e=this.quill.root.parentNode;this.cellSelect=document.createElement("div"),this.cellSelect.classList.add("ql-table-selection_line"),E(this.cellSelect,{"border-color":P}),e.appendChild(this.cellSelect)}mouseDownHandler(e){if(0===e.button&&e.target.closest(".ql-table")){var t=e.target.closest(".ql-table").dataset.tableId,r=e=>{if(0===e.button&&e.target.closest(".ql-table")&&e.target.closest(".ql-table").dataset.tableId===t){var r=e.target.closest("td[data-row-id]"),a=S(r.getBoundingClientRect(),this.quill.root.parentNode);this.boundary=q(l,a),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(),this.repositionHelpLines(),o!==r&&this.quill.blur()}},a=e=>{document.body.removeEventListener("mousemove",r,!1),document.body.removeEventListener("mouseup",a,!1),this.dragging=!1};document.body.addEventListener("mousemove",r,!1),document.body.addEventListener("mouseup",a,!1);var o=e.target.closest("td[data-row-id]"),l=S(o.getBoundingClientRect(),this.quill.root.parentNode);this.dragging=!0,this.boundary=q(l,l),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(),this.repositionHelpLines(),this.addScrollEvent(this.table.parentNode,(()=>{this.repositionHelpLines()}))}}computeSelectedTds(){return n.find(this.table).descendants(z).reduce(((e,t)=>{var r=S(t.domNode.getBoundingClientRect(),this.quill.root.parentNode),a=r.x,o=r.y,l=r.width,n=r.height;return a+2>=this.boundary.x&&a-2+l<=this.boundary.x1&&o+2>=this.boundary.y&&o-2+n<=this.boundary.y1&&e.push(t.getCellInner()),e}),[])}correctBoundary(){n.find(this.table).descendants(z).forEach((e=>{var t=S(e.domNode.getBoundingClientRect(),this.quill.root.parentNode),r=t.x,a=t.y,o=t.width,l=t.height;(r+2>=this.boundary.x&&r+2<=this.boundary.x1||r-2+o>=this.boundary.x&&r-2+o<=this.boundary.x1)&&(a+2>=this.boundary.y&&a+2<=this.boundary.y1||a-2+l>=this.boundary.y&&a-2+l<=this.boundary.y1)&&(this.boundary=q(this.boundary,{x:r,y:a,width:o,height:l}))})),this.scrollX=this.table.parentNode.scrollLeft}repositionHelpLines(){var e=this.table.parentNode.scrollLeft,t=this.quill.root.parentNode.scrollTop;E(this.cellSelect,{display:"block",left:"".concat(this.boundary.x+(this.scrollX-e)-1,"px"),top:"".concat(2*t+this.boundary.y,"px"),width:"".concat(this.boundary.width+1,"px"),height:"".concat(this.boundary.height+1,"px")})}clearSelection(){this.boundary={},this.selectedTds=[],E(this.cellSelect,{display:"none"}),this.clearScrollEvent()}destroy(){return this.clearSelection(),this.cellSelect.remove(),this.cellSelect=null,this.clearScrollEvent(),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),this.quill.off(n.events.TEXT_CHANGE,this.closeHandler),null}}var F={insertColumnLeft:{text:"在左侧插入一列",handler(){this.quill.getModule(b).appendCol(),this.quill.theme.tableToolTip.curTableId=null,this.quill.theme.tableToolTip.hide()}},insertColumnRight:{text:"在右侧插入一列",handler(){this.quill.getModule(b).appendCol(!0),this.quill.theme.tableToolTip.curTableId=null,this.quill.theme.tableToolTip.hide()}},insertRowTop:{text:"在上方插入一行",handler(){this.quill.getModule(b).appendRow()}},insertRowBottom:{text:"在下方插入一行",groupEnd:!0,handler(){this.quill.getModule(b).appendRow(!0)}},removeCol:{text:"删除所在列",handler(){this.quill.getModule(b).removeCol(),this.quill.theme.tableToolTip.curTableId=null,this.quill.theme.tableToolTip.hide()}},removeRow:{text:"删除所在行",handler(){this.quill.getModule(b).removeRow()}},removeTable:{text:"删除表格",groupEnd:!0,handler(){this.quill.getModule(b).removeTable(),this.quill.theme.tableToolTip.hide()}},mergeCell:{text:"合并单元格",groupEnd:!0,handler(){var e=this.quill.getModule(b);e.mergeCells(),e.hideTableTools()}},setBackgroundColor:{subTitle:"设置背景颜色",text(){var e=this.quill.getModule(b),t=document.createElement("input");return t.type="color",t.addEventListener("click",(e=>{e.stopPropagation()})),t.addEventListener("input",(()=>{e.setBackgroundColor(t.value)})),t.style.width="100%",t}}};class G{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.table=e.table,this.quill=t,this.options=r;var a=this.quill.getModule(b);this.tableSelection=a.tableSelection,this.menuItems={},this.optionsMerge(),this.boundary=this.tableSelection.boundary,this.selectedTds=this.tableSelection.selectedTds,this.destroyHandler=this.destroy.bind(this),this.menuInitial(e),this.mount(),document.addEventListener("click",this.destroyHandler,!1)}optionsMerge(){var e,t,r,a,o;null!==(e=this.options)&&void 0!==e&&e.replaceItems?this.menuItems=null!==(t=null===(r=this.options)||void 0===r?void 0:r.items)&&void 0!==t?t:{}:this.menuItems=Object.assign({},F,null!==(a=null===(o=this.options)||void 0===o?void 0:o.items)&&void 0!==a?a:{})}mount(){document.body.appendChild(this.domNode)}menuInitial(e){e.table,e.row,e.cell;var t=e.left,r=e.top;this.domNode=document.createElement("div"),this.domNode.classList.add("ql-table-operation-menu");var a={position:"absolute","min-height":"".concat(150,"px"),width:"".concat(200,"px")},o=window,l=o.innerWidth,n=o.innerHeight;for(var i in t>l-200?a.right="".concat(l-t,"px"):a.left="".concat(t,"px"),r>n-150?a.bottom="".concat(n-r,"px"):a.top="".concat(r,"px"),E(this.domNode,a),this.menuItems)this.menuItems[i]&&(this.menuItems[i].subTitle&&this.domNode.appendChild(d(this.menuItems[i].subTitle)),this.domNode.appendChild(this.menuItemCreator(Object.assign({},F[i],this.menuItems[i]))),this.menuItems[i].groupEnd&&this.domNode.appendChild(s()));function s(){var e=document.createElement("div");return e.classList.add("ql-table-operation-menu-dividing"),e}function d(e){var t=document.createElement("div");return t.classList.add("ql-table-operation-menu-subtitle"),t.innerText=e,t}}destroy(){return this.domNode.remove(),document.removeEventListener("click",this.destroyHandler,!1),null}menuItemCreator(e){var t=e.text,r=e.iconSrc,a=e.handler,o=document.createElement("div");if(o.classList.add("ql-table-operation-menu-item"),r){var l=document.createElement("span");l.classList.add("ql-table-operation-menu-icon"),l.innerHTML=r,o.appendChild(l)}if("string"==typeof t){var n=document.createElement("span");n.classList.add("ql-table-operation-menu-text"),n.innerText=t,o.appendChild(n)}else B(t)&&o.appendChild(t.call(this));return B(a)&&o.addEventListener("click",a.bind(this),!1),o}}var K=n.import("blots/container"),X=n.import("parchment");class U extends K{static create(e){var t=super.create();return t.dataset.rowId=e,t}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.dataset.rowId===this.domNode.dataset.rowId&&(e.moveChildren(this),e.remove())}get rowId(){return this.domNode.dataset.rowId}foreachCellInner(t){for(var r,a=this.children.iterator(),o=0;r=a();){if(t(e(r.descendants(R),1)[0],o++))break}}}U.blotName=p,U.tagName="tr",U.className="ql-table-row",U.scope=X.Scope.BLOCK_BLOT;var Y=n.import("parchment"),V=n.import("blots/block");class $ extends V{static create(e){var t=e.width,r=e.tableId,a=e.colId,o=super.create();return o.setAttribute("width",t),o.dataset.tableId=r,o.dataset.colId=a,o}get width(){return Number(this.domNode.getAttribute("width"))}set width(e){return this.domNode.setAttribute("width",e)}get colId(){return this.domNode.dataset.colId}formats(){var e=this.domNode.dataset,t=e.tableId,r=e.colId;return{[this.statics.blotName]:{tableId:t,colId:r,width:this.domNode.getAttribute("width")}}}optimize(){super.optimize();var e=this.parent;if(null!=e&&e.statics.blotName!=c){var t=Y.create("block");this.parent.insertBefore(t,this.next);var r=Y.create(s,this.domNode.dataset.tableId),a=Y.create(d,this.domNode.dataset.tableId),o=Y.create(c);o.appendChild(this),a.appendChild(o),r.appendChild(a),r.replace(t)}var l=this.next,n=this.domNode.dataset,i=n.tableId,h=n.colId;null!=l&&l.statics.blotName===this.statics.blotName&&l.domNode.tagName===this.domNode.tagName&&l.domNode.dataset.tableId===i&&l.domNode.dataset.colId===h&&(l.moveChildren(this),l.remove())}html(){return this.domNode.outerHTML}}$.blotName=h,$.tagName="col",$.scope=Y.Scope.BLOCK_BLOT;var J=n.import("blots/container"),Q=n.import("parchment");class Z extends J{constructor(e,t){super(e,t),this.formatTableWidth()}static create(e){var t=super.create();return t.dataset.tableId=e,t.classList.add("ql-table"),t.setAttribute("cellpadding",0),t.setAttribute("cellspacing",0),t}computedCorrectWidth(e){setTimeout((()=>{var t=this.children.head,r=t.children.length;t.children.map((t=>{t.width=e/r})),this.colWidthFillTable()}),0)}colWidthFillTable(){var e=this.children.head;if(e&&e.statics.blotName===c){var t=e.children.reduce(((e,t)=>t.width+e),0);return this.domNode.style.width=t+"px",t}}formatTableWidth(){setTimeout((()=>{this.colWidthFillTable()}),0)}get tableId(){return this.domNode.dataset.tableId}getRows(){return this.descendants(U)}getRowIds(){return this.getRows().map((e=>e.rowId))}getCols(){return this.descendants($)}getColIds(){return this.getCols().map((e=>e.colId))}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&e.domNode.dataset.tableId===this.domNode.dataset.tableId&&(e.moveChildren(this),e.remove())}}Z.blotName=d,Z.tagName="table",Z.scope=Q.Scope.BLOCK_BLOT;var ee=n.import("blots/container"),te=n.import("parchment");class re extends ee{optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&(e.moveChildren(this),e.remove())}deleteAt(e,t){0===e&&t===this.length()&&this.parent.remove(),this.children.forEachAt(e,t,(function(e,t,r){e.deleteAt(t,r)}))}}re.blotName=u,re.tagName="tbody",re.scope=te.Scope.BLOCK_BLOT;var ae=n.import("blots/container"),oe=n.import("parchment");class le extends ae{optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&(e.moveChildren(this),e.remove())}findCol(e){for(var t,r=this.children.iterator(),a=0;(t=r())&&a!==e;)a++;return t}}le.blotName=c,le.tagName="colgroup",le.scope=oe.Scope.BLOCK_BLOT;var ne=n.import("parchment"),ie=n.import("delta"),se=n.import("blots/block/embed"),de=n.import("blots/block"),ce=n.import("blots/container"),he=n.import("ui/icons");O.allowedChildren=[de,se,ce],y.allowedChildren=[Z],Z.allowedChildren=[re,le],Z.requiredContainer=y,re.allowedChildren=[U],re.requiredContainer=Z,le.allowedChildren=[$],le.requiredContainer=Z,U.allowedChildren=[z],U.requiredContainer=re,z.allowedChildren=[R],R.defaultChild="block",R.allowedChildren=[de,se,ce],n.register({["formats/".concat(O.blotName)]:O,["formats/".concat(R.blotName)]:R,["formats/".concat(z.blotName)]:z,["formats/".concat(U.blotName)]:U,["formats/".concat(re.blotName)]:re,["formats/".concat(Z.blotName)]:Z,["formats/".concat(y.blotName)]:y,["formats/".concat(le.blotName)]:le,["formats/".concat($.blotName)]:$},!0);class ue{constructor(t,r){this.quill=t,this.options=r,this.tableBtn=null,this.tableInsertSelectCloseHandler=null;var a=this.quill.getModule("toolbar");if(a){var o=a.controls.find((t=>e(t,1)[0]===ue.toolName));o&&(this.tableBtn=o[1]),this.buildCustomSelect(this.options.customSelect),a.addHandler(ue.toolName,this.handleSelectDisplay.bind(this))}this.pasteTableHandler(),this.quill.root.addEventListener("click",(e=>{var r,a=e.path||e.composedPath&&e.composedPath();if(a&&!(a.length<=0)){var o=null===(r=a.filter((e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("ql-table"))))||void 0===r?void 0:r[0];if(o){if(this.table===o)return;this.table&&this.hideTableTools(),this.showTableTools(o,t,this.options.selection)}else this.table&&this.hideTableTools()}}),!1),this.quill.root.addEventListener("contextmenu",(e=>{var r;if(!this.table)return!0;e.preventDefault();var a=e.path||e.composedPath&&e.composedPath();if(a&&!(a.length<=0)){var o=a.filter((e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("ql-table")))[0];if(o&&null!==(r=this.tableSelection)&&void 0!==r&&null!==(r=r.selectedTds)&&void 0!==r&&r.length){this.tableOperationMenu&&(this.tableOperationMenu=this.tableOperationMenu.destroy());var l=a.filter((e=>e.tagName&&"TR"===e.tagName.toUpperCase()&&e.getAttribute("data-row-id")))[0],n=a.filter((e=>e.tagName&&"TD"===e.tagName.toUpperCase()&&e.getAttribute("data-row-id")))[0];this.tableOperationMenu=new G({table:o,row:l,cell:n,left:e.pageX,top:e.pageY},t,this.options.operationMenu)}}})),this.quill.theme.tableToolTip=new M(this.quill,this.options.tableToolTip)}showTableTools(e,t,r){this.table=e,this.tableSelection=new W(e,t,r)}hideTableTools(){this.tableSelection&&this.tableSelection.destroy(),this.tableOperationMenu&&this.tableOperationMenu.destroy(),this.tableSelection=null,this.tableOperationMenu=null,this.table=null}pasteTableHandler(){var e=I(),t=I(),r=[],a=!1,o=0;this.quill.clipboard.addMatcher(d,((t,l)=>{var n=Array.from(t.getElementsByTagName("tr")).reduce(((e,t)=>{var r=Array.from(t.getElementsByTagName("td")).map((e=>e.getBoundingClientRect().width));return r.length<e.length?e:r.map(((t,r)=>{var a;return Math.max(t,null!==(a=e[r])&&void 0!==a?a:0)})).concat(e.slice(r.length))}),[]),i=new ie;return r.map(((t,r)=>{var a;i.insert("\n",{[h]:{colId:t,tableId:e,width:null!==(a=n[r])&&void 0!==a?a:150}})})),e=I(),r=[],a=!1,o=0,i.concat(l)})),this.quill.clipboard.addMatcher(p,((e,r)=>(t=I(),a=!0,r))),this.quill.clipboard.addMatcher(m,((l,n)=>(a||r.push(I()),o+=1,n.compose((new ie).retain(n.length(),{[v]:{tableId:e,rowId:t,colId:r[(o-1)%r.length],rowspan:l.getAttribute("rowspan"),colspan:l.getAttribute("colspan"),style:l.getAttribute("style")}})))))}buildCustomSelect(e){var t=this;return l(a().mark((function r(){var o,l;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.tableBtn){r.next=2;break}return r.abrupt("return");case 2:if((o=document.createElement("div")).classList.add("ql-custom-select"),!e||!B(e)){r.next=10;break}return r.next=7,e();case 7:r.t0=r.sent,r.next=11;break;case 10:r.t0=t.createSelect();case 11:l=r.t0,o.appendChild(l),l.addEventListener(N,(e=>{var r=e.detail,a=r.row,o=r.col;a&&o&&t.insertTable(a,o)})),t.tableBtn.appendChild(o),t.tableBtn.style.position="relative";case 16:case"end":return r.stop()}}),r)})))()}handleSelectDisplay(){var e=this;return l(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.quill.focus(),e.range=e.quill.getSelection(),e.tableBtn.classList.add("ql-expanded"),e.tableBtn.dataset.active=!0,window.removeEventListener("click",e.tableInsertSelectCloseHandler),e.tableInsertSelectCloseHandler=e.closeSelecte.bind(e),window.addEventListener("click",e.tableInsertSelectCloseHandler);case 7:case"end":return t.stop()}}),t)})))()}createSelect(){return(()=>{var e=document.createElement("div");e.classList.add("create_select");var t=document.createElement("div");t.classList.add("create_select_block");for(var r=0;r<8;r++)for(var a=0;a<8;a++){var o=document.createElement("div");o.classList.add("create_select_block_item"),o.dataset.row=r+1,o.dataset.col=a+1,t.appendChild(o)}var l=document.createElement("div");l.classList.add("create_select_custom"),l.innerText="自定义行列数",e.appendChild(t),e.appendChild(l);var n=t=>{var r=t.row,a=t.col;e.dispatchEvent(new CustomEvent(N,{detail:{row:Number(r),col:Number(a)}}))},i=()=>{var r=e.dataset,a=r.row,o=r.col;if([].forEach.call(t.querySelectorAll(".active"),(e=>{e.classList.remove("active")})),a&&o)for(var l=Array.from(t.children),n=0;n<l.length;n++){if(l[n].dataset.row>a&&l[n].dataset.col>o)return;l[n].dataset.row<=a&&l[n].dataset.col<=o?l[n].classList.add("active"):l[n].classList.remove("active")}};return t.addEventListener("mousemove",(t=>{var r=t.target.dataset,a=r.row,o=r.col;a&&o&&(e.dataset.row=a,e.dataset.col=o,i())})),t.addEventListener("mouseleave",(t=>{e.removeAttribute("data-row"),e.removeAttribute("data-col"),i()})),t.addEventListener("click",(()=>{var t=e.dataset,r=t.row,a=t.col;r&&a&&n({row:r,col:a})})),l.addEventListener("click",(()=>{L().then((e=>{var t=e.row,r=e.col;n({row:t,col:r})}))})),e})()}closeSelecte(e){var t=(e.composedPath&&e.composedPath()||e.path).findIndex((e=>e===this.tableBtn));(t>2||-1===t)&&(this.tableBtn.classList.remove("ql-expanded"),this.tableBtn.dataset.active=!1,window.removeEventListener("click",this.tableInsertSelectCloseHandler))}insertTable(e,t){if(e>=100||t>=100)throw new Error("Both rows and columns must be less than 100.");var r=this.range;if(null!=r){var a=this.quill.getLeaf(r.index)[0];if(ve(a))throw new Error("Not supported nesting of "+a.type+" type object within a table.");setTimeout((()=>{var a=(new ie).retain(r.index);a.insert("\n");var o=I(),l=new Array(t).fill(0).map((()=>I())),i=getComputedStyle(this.quill.root),s=i.width,d=i.paddingLeft,c=i.paddingRight;s=parseInt(s),d=parseInt(d),c=parseInt(c),a=new Array(t).fill("\n").reduce(((e,r,a)=>(e.insert(r,{[h]:{width:Math.floor((s-d-c-1)/t),tableId:o,colId:l[a]}}),e)),a),a=new Array(e).fill(0).reduce((e=>{var r=I();return new Array(t).fill("\n").reduce(((e,t,a)=>(e.insert(t,{[v]:{tableId:o,rowId:r,colId:l[a],rowspan:1,colspan:1}}),e)),e)}),a),this.quill.updateContents(a,n.sources.USER),this.quill.setSelection(r.index+t+t*e+1,n.sources.API),this.quill.focus()}),0)}}findTable(e){for(var t=e;t.statics.blotName!==d&&null!==t;)t=t.parent;return t}appendRow(e){var t=this.tableSelection.selectedTds;if(t.length){var r=this.findTable(t[0]),a=t[e?t.length-1:0],o=n.find(a.domNode.parentNode.parentNode);if(e)for(var l=a.rowspan;l>1;)o=o.next,l-=1;var i=r.getColIds(),s=new Set(i),d=e?o:o.prev,c=new Array,h=0;for(d||(s.clear(),c=i);s.size&&(h+=1,d);)d.foreachCellInner((e=>{if(s.has(e.colId)){var t=[e.colId];if(e.colspan>1){var r=i.findIndex((t=>t===e.colId));-1===r&&(r=0),t=i.slice(r,r+e.colspan)}e.rowspan>h?e.rowspan+=1:c.push(...t),t.map((e=>s.delete(e)))}})),d=d.prev;for(var u=r.tableId,b=I(),f=ne.create(p,b),g=new Set(c),w=0;w<i.length&&g.size;w++)if(g.has(i[w])){var y=ne.create(m,{rowId:b,colId:i[w],rowspan:1,colspan:1}),N=ne.create(v,{tableId:u,rowId:b,colId:i[w],rowspan:1,colspan:1}),C=ne.create("block");C.appendChild(ne.create("break")),N.appendChild(C),y.appendChild(N),f.appendChild(y),g.delete(i[w])}o.parent.insertBefore(f,e?o.next:o)}}removeRow(){if(this.tableSelection.selectedTds.length){var t=this.tableSelection.selectedTds,r=t.reduce(((e,t)=>(e[0].has(t.rowId)||(e[0].add(t.rowId),e[1].push(t.parent.parent)),e)),[new Set,[]]),a=e(r,2),o=a[0],l=a[1];o=Array.from(o);var i=new Map;l.map((e=>{e.foreachCellInner((e=>{var t=o.findIndex((t=>t===e.rowId));e.rowspan>o.length-t&&i.set(e.colId,{cell:e,rowspan:e.rowspan-o.length+t})})),e.remove()}));var s=this.findTable(t[0]),d=s.tableId;if(i.size)for(var c=l[l.length-1].next,h=s.getColIds(),u=null,p=0;p<h.length;){var b=c.domNode.querySelector('td[data-col-id="'.concat(h[p],'"]'));if(b){var f=n.find(b);p+=f.colspan,u=f.next}else{var g=i.get(h[p]),w=g.cell,y=g.rowspan,N=ne.create(m,{rowId:c.rowId,colId:h[p],rowspan:y,colspan:w.colspan}),I=ne.create(v,{tableId:d,rowId:c.rowId,colId:h[p],rowspan:y,colspan:w.colspan});w.moveChildren(I),N.appendChild(I),c.insertBefore(N,u),p+=w.colspan}}}}appendCol(e){if(this.tableSelection.selectedTds.length){var t,r=this.tableSelection.selectedTds,a=this.findTable(r[0]),o=a.getCols(),l=a.getColIds(),n=a.getRows(),i=I();if(e){var s=r[r.length-1],d=l.findIndex((e=>e===s.colId));t=l[d+s.colspan-1]}else t=r[0].colId;var c=o.findIndex((r=>{if(r.colId===t){var o=ne.create(h,{width:160,tableId:a.tableId,colId:i});r.parent.insertBefore(o,e?r.next:r)}return r.colId===t}));a.formatTableWidth();var u=e?c+1:c,p=0;n.map((e=>{var t=!1,r=null;if(e.foreachCellInner((e=>{if(p>0)return p-=1,t=!0,!0;var a=l.findIndex((t=>t===e.colId));return e.colspan+a>u&&(r=e.parent,1!==e.colspan&&a!==u)?(e.colspan+=1,t=!0,p=e.rowspan-1,!0):a>=u||void 0})),!t){var o=ne.create(m,{rowId:e.rowId,colId:i,rowspan:1,colspan:1}),n=ne.create(v,{tableId:a.tableId,rowId:e.rowId,colId:i,rowspan:1,colspan:1});o.appendChild(n),e.insertBefore(o,r)}}))}}removeCol(){if(this.tableSelection.selectedTds.length){var t=this.tableSelection.selectedTds,r=this.findTable(this.tableSelection.selectedTds[0]),a=r.getColIds(),o=t.reduce(((e,t)=>{var r=a.findIndex((e=>e===t.colId));return[Math.min(e[0],r),Math.max(e[1],r+t.colspan-1)]}),[1/0,-1/0]),l=e(o,2),n=l[0],i=l[1];r.getRows().map((e=>{var t=0;e.foreachCellInner((e=>{if(t>i)return!0;var r=e.colspan;t+r-1>i?e.colspan-=i-Math.max(t,n)+1:t<n&&t+r-1>=n?e.colspan-=t+r-n:t>=n&&e.remove(),t+=r}))}));for(var s=r.getCols(),d=0;d<s.length&&(d>=n&&d<=i&&s[d].remove(),!(d>i));d++);r.formatTableWidth()}}removeTable(){var e=this.tableSelection.selectedTds;e.length&&this.findTable(e[0]).remove()}mergeCells(){if(this.tableSelection.selectedTds.length){var e=this.tableSelection.selectedTds,t=e.reduce(((e,t)=>{var r=t.colId;e[0][r]||(e[0][r]=0),e[0][r]+=t.rowspan;var a=t.rowId;return e[1][a]||(e[1][a]=0),e[1][a]+=t.colspan,e}),[{},{}]),r=Math.max(...Object.values(t[0])),a=Math.max(...Object.values(t[1])),o=e[0].clone();e[0].parent.appendChild(o),o.colspan=a,o.rowspan=r;for(var l=0;l<e.length;l++)e[l].moveChildren(o),e[l].remove();var n=this.findTable(e[0]);if(n.getColIds().length===a&&(o.rowspan=1),n.getRowIds().length<=r){for(var i=n.descendants($),s=o.colspan-1,d=null,c=0;c<i.length&&!(s<=0);c++)null!==d&&(i[d].width+=i[c].width,i[c].remove(),s-=1),i[c].colId===o.colId&&(d=c);o.colspan=1}}}setBackgroundColor(e){this.tableSelection.selectedTds.length&&this.tableSelection.selectedTds.map((t=>t.style="background-color: ".concat(e,";")))}}var pe=[m],me=e=>pe.includes(e.statics.blotName),ve=e=>!(!e||!e.parent)&&(!!me(e.parent)||ve(e.parent));ue.moduleName=b,ue.toolName=f,ue.createEventName=N,he[ue.toolName]='<svg viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm0 5h18M10 3v18"/></svg>';export{ue as default,ve as isForbidInTable,me as isForbidInTableBlot,pe as tableCantInsert};
