function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,a,i,l,n=[],s=!0,d=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(o=i.call(r)).done)&&(n.push(o.value),n.length!==t);s=!0);}catch(e){d=!0,a=e}finally{try{if(!s&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(d)throw a}}return n}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},l="function"==typeof Symbol?Symbol:{},n=l.iterator||"@@iterator",s=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function h(e,t,r,o){var a=t&&t.prototype instanceof g?t:g,l=Object.create(a.prototype),n=new M(o||[]);return i(l,"_invoke",{value:E(e,r,n)}),l}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="suspendedYield",v="executing",b="completed",f={};function g(){}function w(){}function y(){}var N={};c(N,n,(function(){return this}));var I=Object.getPrototypeOf,C=I&&I(I(k([])));C&&C!==r&&o.call(C,n)&&(N=C);var x=y.prototype=g.prototype=Object.create(N);function T(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(a,i,l,n){var s=u(e[a],e,i);if("throw"!==s.type){var d=s.arg,c=d.value;return c&&"object"==typeof c&&o.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,l,n)}),(function(e){r("throw",e,l,n)})):t.resolve(c).then((function(e){d.value=e,l(d)}),(function(e){return r("throw",e,l,n)}))}n(s.arg)}var a;i(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,a){r(e,o,t,a)}))}return a=a?a.then(i,i):i()}})}function E(t,r,o){var a=p;return function(i,l){if(a===v)throw Error("Generator is already running");if(a===b){if("throw"===i)throw l;return{value:e,done:!0}}for(o.method=i,o.arg=l;;){var n=o.delegate;if(n){var s=S(n,o);if(s){if(s===f)continue;return s}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(a===p)throw a=b,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a=v;var d=u(t,r,o);if("normal"===d.type){if(a=o.done?b:m,d.arg===f)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a=b,o.method="throw",o.arg=d.arg)}}}function S(t,r){var o=r.method,a=t.iterator[o];if(a===e)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=e,S(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),f;var i=u(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function q(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(q,this),this.reset(!0)}function k(t){if(t||""===t){var r=t[n];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function r(){for(;++a<t.length;)if(o.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return w.prototype=y,i(x,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:w,configurable:!0}),w.displayName=c(y,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,d,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},T(L.prototype),c(L.prototype,s,(function(){return this})),t.AsyncIterator=L,t.async=function(e,r,o,a,i){void 0===i&&(i=Promise);var l=new L(h(e,r,o,a),i);return t.isGeneratorFunction(r)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},T(x),c(x,d,"Generator"),c(x,n,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var o in t)r.push(o);return r.reverse(),function e(){for(;r.length;){var o=r.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=k,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(o,a){return n.type="throw",n.arg=t,r.next=o,a&&(r.method="next",r.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var l=this.tryEntries[i],n=l.completion;if("root"===l.tryLoc)return a("end");if(l.tryLoc<=this.prev){var s=o.call(l,"catchLoc"),d=o.call(l,"finallyLoc");if(s&&d){if(this.prev<l.catchLoc)return a(l.catchLoc,!0);if(this.prev<l.finallyLoc)return a(l.finallyLoc)}else if(s){if(this.prev<l.catchLoc)return a(l.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return a(l.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var l=i?i.completion:{};return l.type=e,l.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(l)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),B(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var a=o.arg;B(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,o){return this.delegate={iterator:k(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=e),f}},t}function i(e,t,r,o,a,i,l){try{var n=e[i](l),s=n.value}catch(e){return void r(e)}n.done?t(s):Promise.resolve(s).then(o,a)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var l=e.apply(t,r);function n(e){i(l,o,a,n,s,"next",e)}function s(e){i(l,o,a,n,s,"throw",e)}n(void 0)}))}}import n from"quill";var s="createTable",d="contain",c="tableWrapper",h="table",u="colgroup",p="col",m="tbody",v="tr",b="td",f="tableCellInner",g="table",w="table",y=()=>Math.random().toString(36).slice(2),N=8e3,I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.child,r=e.target,o=void 0===r?document.body:r,a=e.beforeClose,i=void 0===a?()=>{}:a,l=o,n=document.createElement("div");n.classList.add("dialog"),n.style.zIndex=N;var s=document.createElement("div");if(s.classList.add("dialog_overlay"),n.appendChild(s),t){var d=document.createElement("div");d.classList.add("dialog_content"),d.appendChild(t),s.appendChild(d),d.onclick=e=>{e.stopPropagation()}}var c=getComputedStyle(l).overflow;l.style.overflow="hidden",l.appendChild(n);var h=()=>{i(),n.remove(),l.style.overflow=c};return n.onclick=h,N+=1,{dialog:n,close:h}},C=(e,t)=>{t.type||(t.type="text"),t.value||(t.value="");var r=document.createElement("div");if(r.classList.add("input_item"),e){var o=document.createElement("span");o.classList.add("input_label"),o.innerText=e,r.appendChild(o)}var a=document.createElement("div");a.classList.add("input_input");var i=document.createElement("input");for(var l in t)i.setAttribute(l,t[l]);(t.max||t.min)&&i.addEventListener("blur",(()=>{t.max&&t.max<=i.value&&(i.value=t.max),t.min&&t.min>=i.value&&(i.value=t.min)})),a.appendChild(i),r.appendChild(a),i.onfocus=()=>{a.classList.add("focus")},i.onblur=()=>{a.classList.remove("focus")};var n=e=>{if(a.classList.contains("error"))a.querySelector(".error_tip").innerText=e;else{var t=document.createElement("span");t.classList.add("error_tip"),t.innerText=e,a.appendChild(t)}a.classList.add("error");return{removeError:()=>{a.classList.remove("error"),n.remove()}}};return{item:r,input:i,errorTip:n}},x=function(){var e=l(a().mark((function e(){var t,r,o,i,n,s,d,c,h,u,p,m,v,b,f,g=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.length>0&&void 0!==g[0]?g[0]:3,r=g.length>1&&void 0!==g[1]?g[1]:3,(o=document.createElement("div")).classList.add("create_box"),(i=document.createElement("div")).classList.add("create_input_content"),n=C("row",{type:"number",value:t,max:99}),s=n.item,d=n.input,c=n.errorTip,h=C("col",{type:"number",value:r,max:99}),u=h.item,p=h.input,m=h.errorTip,i.appendChild(s),i.appendChild(u),o.appendChild(i),(v=document.createElement("div")).classList.add("create_control"),(b=document.createElement("button")).classList.add("create_control_btn","confirm"),b.innerText="Confirm",(f=document.createElement("button")).classList.add("create_control_btn","cancel"),f.innerText="Cancel",v.appendChild(b),v.appendChild(f),o.appendChild(v),e.abrupt("return",new Promise(((e,t)=>{var r=I({child:o,beforeClose:t}).close;b.onclick=l(a().mark((function t(){var o,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Number(d.value),i=Number(p.value),!(isNaN(o)||o<=0)){t.next=4;break}return t.abrupt("return",c("Invalid number"));case 4:if(!(isNaN(i)||i<=0)){t.next=6;break}return t.abrupt("return",m("Invalid number"));case 6:e({row:o,col:i}),r();case 8:case"end":return t.stop()}}),t)}))),f.onclick=()=>{r()}})));case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function T(e,t){if("object"==typeof t)for(var r in t)e.style[r]=t[r]}function L(e,t){var r=t.getBoundingClientRect();return{x:e.x-r.x-t.scrollLeft,y:e.y-r.y-t.scrollTop,x1:e.x-r.x-t.scrollLeft+e.width,y1:e.y-r.y-t.scrollTop+e.height,width:e.width,height:e.height}}function E(e,t){var r=Math.min(e.x,t.x,e.x+e.width-1,t.x+t.width-1),o=Math.max(e.x,t.x,e.x+e.width-1,t.x+t.width-1),a=Math.min(e.y,t.y,e.y+e.height-1,t.y+t.height-1),i=Math.max(e.y,t.y,e.y+e.height-1,t.y+t.height-1);return{x:r,x1:o,y:a,y1:i,width:o-r,height:i-a}}function S(e){return"function"==typeof e}var q={insertColumnLeft:{text:"在左侧插入一列",handler(){var e=this.quill.getModule(g);e.appendCol(),e.hideTableTools()}},insertColumnRight:{text:"在右侧插入一列",handler(){var e=this.quill.getModule(g);e.appendCol(!0),e.hideTableTools()}},insertRowTop:{text:"在上方插入一行",handler(){var e=this.quill.getModule(g);e.appendRow(),e.hideTableTools()}},insertRowBottom:{text:"在下方插入一行",groupEnd:!0,handler(){var e=this.quill.getModule(g);e.appendRow(!0),e.hideTableTools()}},removeCol:{text:"删除所在列",handler(){var e=this.quill.getModule(g);e.removeCol(),e.hideTableTools()}},removeRow:{text:"删除所在行",handler(){var e=this.quill.getModule(g);e.removeRow(),e.hideTableTools()}},removeTable:{text:"删除表格",groupEnd:!0,handler(){var e=this.quill.getModule(g);e.removeTable(),e.hideTableTools()}},mergeCell:{text:"合并单元格",groupEnd:!0,handler(){var e=this.quill.getModule(g);e.mergeCells(),e.hideTableTools()}},setBackgroundColor:{text(){var e=document.createElement("span");e.innerText="设置背景颜色";var t=this.quill.getModule(g),r=document.createElement("input");r.type="color",r.addEventListener("click",(e=>{e.stopPropagation()}));var o=t.tableSelection.selectedTds;return r.addEventListener("input",(()=>{t.setStyle({backgroundColor:r.value},o)})),r.style.marginLeft="auto",[e,r]}},clearBackgroundColor:{text:"清除背景颜色",handler(){var e=this.quill.getModule(g);e.setStyle({backgroundColor:null},e.tableSelection.selectedTds)}},setBorderColor:{text(){var e=document.createElement("span");e.innerText="设置边框颜色";var t=this.quill.getModule(g),r=document.createElement("input");r.type="color",r.addEventListener("click",(e=>{e.stopPropagation()}));var o=t.tableSelection.selectedTds;return r.addEventListener("input",(()=>{t.setStyle({borderColor:r.value},o)})),r.style.marginLeft="auto",[e,r]}},clearBorderColor:{text:"清除边框颜色",handler(){var e=this.quill.getModule(g);e.setStyle({borderColor:null},e.tableSelection.selectedTds)}}};class B{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.table=e.table,this.quill=t,this.options=r;var o=this.quill.getModule(g);this.tableSelection=o.tableSelection,this.menuItems={},this.optionsMerge(),this.optionsModify(),this.boundary=this.tableSelection.boundary,this.selectedTds=this.tableSelection.selectedTds,this.destroyHandler=this.destroy.bind(this),this.menuInitial(e),document.addEventListener("click",this.destroyHandler,!1)}optionsMerge(){var e,t,r,o;if(null!==(e=this.options)&&void 0!==e&&e.replaceItems)this.menuItems=null!==(r=null===(o=this.options)||void 0===o?void 0:o.items)&&void 0!==r?r:{};else if(null===(t=this.options)||void 0===t||!t.modifyItems){var a,i;this.menuItems=Object.assign({},q,null!==(a=null===(i=this.options)||void 0===i?void 0:i.items)&&void 0!==a?a:{})}}overrideButton(e,t){q[e]={text(){var r=document.createElement("span");r.innerText=t.text;var o=this.quill.getModule(g),a=document.createElement("input");a.type="color",a.addEventListener("click",(e=>{e.stopPropagation()}));var i=o.tableSelection.selectedTds;return a.addEventListener("input",(()=>{switch(e){case"setBorderColor":o.setStyle({borderColor:a.value},i);break;case"setBackgroundColor":o.setStyle({backgroundColor:a.value},i)}})),a.style.marginLeft="auto",[r,a]}}}optionsModify(){var e,r=this;if(null!==(e=this.options)&&void 0!==e&&e.modifyItems){for(var o=function(){var e=t(i[a],2),o=e[0],l=e[1];if(!q.hasOwnProperty(o))return 1;switch(o){case"setBorderColor":case"setBackgroundColor":r.overrideButton(o,l);break;default:var n=q[o];Object.keys(l).forEach((e=>{n[e]=l[e]}))}},a=0,i=Object.entries(null===(l=this.options)||void 0===l?void 0:l.items);a<i.length;a++){var l;o()}this.menuItems=Object.assign({},q)}}setMenuPosition(e){var t=e.left,r=e.top,o=this.quill.container.getBoundingClientRect(),a=this.domNode.getBoundingClientRect(),i=t-o.left,l=r-o.top;i+a.width>o.width&&(i=o.width-a.width),l+a.height>o.height&&(l=o.height-a.height),Object.assign(this.domNode.style,{left:"".concat(i,"px"),top:"".concat(l,"px")})}menuInitial(e){e.table,e.row,e.cell;var t=e.left,r=e.top;for(var o in this.domNode=document.createElement("div"),this.domNode.classList.add("ql-table-operation-menu"),T(this.domNode,{position:"absolute","min-height":"".concat(150,"px")}),this.menuItems)this.menuItems[o]&&(this.menuItems[o].subTitle&&this.domNode.appendChild(i(this.menuItems[o].subTitle)),this.domNode.appendChild(this.menuItemCreator(Object.assign({},q[o],this.menuItems[o]))),this.menuItems[o].groupEnd&&this.domNode.appendChild(a()));function a(){var e=document.createElement("div");return e.classList.add("ql-table-operation-menu-dividing"),e}function i(e){var t=document.createElement("div");return t.classList.add("ql-table-operation-menu-subtitle"),t.innerText=e,t}this.quill.container.appendChild(this.domNode),this.setMenuPosition({left:t,top:r})}destroy(){return this.domNode.remove(),document.removeEventListener("click",this.destroyHandler,!1),null}menuItemCreator(e){var t=e.text,r=e.iconSrc,o=e.handler,a=document.createElement("div");if(a.classList.add("ql-table-operation-menu-item"),r){var i=document.createElement("span");i.classList.add("ql-table-operation-menu-icon"),i.innerHTML=r,a.appendChild(i)}if("string"==typeof t){var l=document.createElement("span");l.classList.add("ql-table-operation-menu-text"),l.innerText=t,a.appendChild(l)}else if(S(t)){var n=t.call(this);(function(e){return Array.isArray(e)})(n)||(n=[n]),n.map((e=>a.appendChild(e)))}return S(o)&&a.addEventListener("click",o.bind(this),!1),a}}var M=n.import("blots/container"),k=n.import("parchment");class A extends M{optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&(e.moveChildren(this),e.remove())}deleteAt(e,t){0===e&&t===this.length()&&this.parent.remove(),this.children.forEachAt(e,t,(function(e,t,r){e.deleteAt(t,r)}))}}A.blotName=m,A.tagName="tbody",A.scope=k.Scope.BLOCK_BLOT;var O=n.import("blots/container"),_=n.import("parchment");class H extends O{static create(){return super.create()}insertBefore(e,t){e.statics.blotName==this.statics.blotName?super.insertBefore(e.children.head,t):super.insertBefore(e,t)}format(e,t){this.children.tail.format(e,t)}replace(e){if(e.statics.blotName!==this.statics.blotName){var t=_.create(this.statics.defaultChild);e.moveChildren(t),this.appendChild(t)}null!=e.parent&&super.replace(e)}}H.blotName=d,H.tagName="contain",H.scope=_.Scope.BLOCK_BLOT,H.defaultChild="block";var R=n.import("parchment");class j extends H{static create(e){var t=e.tableId,r=e.rowId,o=e.colId,a=e.rowspan,i=e.colspan,l=e.style,n=super.create();return n.dataset.tableId=t,n.dataset.rowId=r,n.dataset.colId=o,n.dataset.rowspan=a||1,n.dataset.colspan=i||1,n._style=l,n}clearDeltaCache(){this.children.forEach((e=>{e.cache={}}))}get rowId(){return this.domNode.dataset.rowId}get colId(){return this.domNode.dataset.colId}get rowspan(){return Number(this.domNode.dataset.rowspan)}set rowspan(e){this.parent&&(this.parent.rowspan=e),this.domNode.dataset.rowspan=e,this.clearDeltaCache()}get colspan(){return Number(this.domNode.dataset.colspan)}set colspan(e){this.parent&&(this.parent.colspan=e),this.domNode.dataset.colspan=e,this.clearDeltaCache()}set style(e){this.parent.style=e,this.domNode._style=this.parent.style,this.clearDeltaCache()}replace(e){if(e.statics.blotName!==this.statics.blotName){var t=e.clone();e.moveChildren(t),this.appendChild(t),e.parent.insertBefore(this,e.next),e.remove()}else super.replace(e)}format(e,t){super.format(e,t),this.clearDeltaCache()}formats(){var e=this.domNode.dataset,t=e.tableId,r=e.rowId,o=e.colId,a=e.rowspan,i=e.colspan;return{[this.statics.blotName]:{tableId:t,rowId:r,colId:o,rowspan:a,colspan:i,style:this.domNode._style}}}optimize(){super.optimize();var e=this.parent,t=this.domNode.dataset,r=t.tableId,o=t.colId,a=t.rowId,i=t.rowspan,l=t.colspan;if(null!=e&&e.statics.blotName!=b){var n=R.create("block");this.parent.insertBefore(n,this.next);var s=R.create(c,r),d=R.create(h,r),u=R.create(m),p=R.create(v,a),f=R.create(b,{tableId:r,rowId:a,colId:o,rowspan:i,colspan:l,style:this.domNode._style});f.appendChild(this),p.appendChild(f),u.appendChild(p),d.appendChild(u),s.appendChild(d),s.replace(n)}var g=this.next;null!=g&&g.prev===this&&g.statics.blotName===this.statics.blotName&&(g.moveChildren(this),g.remove())}}j.blotName=f,j.tagName="p",j.className="ql-table-cell-inner";var P=n.import("parchment"),D=n.import("blots/container");class W extends D{static create(e){var t=e.rowId,r=e.colId,o=e.rowspan,a=e.colspan,i=e.style,l=super.create();return l.dataset.rowId=t,l.dataset.colId=r,l.setAttribute("rowspan",o||1),l.setAttribute("colspan",a||1),l.style.cssText=i,l}get rowId(){return this.domNode.dataset.rowId}get colId(){return this.domNode.dataset.colId}get rowspan(){return Number(this.domNode.getAttribute("rowspan"))}set rowspan(e){this.domNode.setAttribute("rowspan",e)}get colspan(){return Number(this.domNode.getAttribute("colspan"))}set colspan(e){this.domNode.setAttribute("colspan",e)}get style(){return this.domNode.style.cssText}set style(e){Object.assign(this.domNode.style,e)}getCellInner(){return this.descendants(j)[0]}optimize(){super.optimize();var e=this.domNode.dataset,t=e.colId,r=e.rowId,o=this.next;null!=o&&o.prev===this&&o.statics.blotName===this.statics.blotName&&o.domNode.dataset.rowId===r&&o.domNode.dataset.colId===t&&(o.moveChildren(this),o.remove())}deleteAt(e,t){if(0===e&&t===this.length()){var r=this.next||this.prev,o=r&&r.getCellInner();return o&&(o.colspan+=this.colspan),this.remove()}this.children.forEachAt(e,t,(function(e,t,r){e.deleteAt(t,r)}))}}W.blotName=b,W.tagName="td",W.className="ql-table-cell",W.scope=P.Scope.BLOCK_BLOT;var z=n.import("parchment");n.import("blots/block/embed"),n.import("blots/block"),n.import("blots/container");class F extends H{static create(e){var t=e.width,r=e.tableId,o=e.colId,a=e.full,i=super.create();return i.setAttribute("width","".concat(parseFloat(t)).concat(a?"%":"px")),a&&i.setAttribute("data-full",a),i.dataset.tableId=r,i.dataset.colId=o,i.setAttribute("contenteditable",!1),i}get width(){var e=this.domNode.getAttribute("width");return parseFloat(e)}set width(e){var t=parseFloat(e);return this.domNode.setAttribute("width","".concat(t).concat(this.full?"%":"px"))}get colId(){return this.domNode.dataset.colId}get full(){return this.domNode.hasAttribute("data-full")}formats(){var e=this.domNode.dataset,t=e.tableId,r=e.colId;return{[this.statics.blotName]:{tableId:t,colId:r,width:this.domNode.getAttribute("width"),full:this.domNode.hasAttribute("data-full")}}}optimize(){super.optimize();var e=this.parent;if(null!=e&&e.statics.blotName!=u){var t=z.create("block");this.parent.insertBefore(t,this.next);var r=z.create(c,this.domNode.dataset.tableId),o=z.create(h,this.domNode.dataset.tableId);this.full&&(o.full=!0);var a=z.create(u);a.appendChild(this),o.appendChild(a),r.appendChild(o),r.replace(t)}var i=this.next,l=this.domNode.dataset,n=l.tableId,s=l.colId;null!=i&&i.statics.blotName===this.statics.blotName&&i.domNode.tagName===this.domNode.tagName&&i.domNode.dataset.tableId===n&&i.domNode.dataset.colId===s&&(i.moveChildren(this),i.remove())}}F.blotName=p,F.tagName="col",F.scope=z.Scope.BLOCK_BLOT;var G=n.import("blots/container"),X=n.import("parchment");class K extends G{optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&(e.moveChildren(this),e.remove())}findCol(e){for(var t,r=this.children.iterator(),o=0;(t=r())&&o!==e;)o++;return t}}K.blotName=u,K.tagName="colgroup",K.scope=X.Scope.BLOCK_BLOT;var U=n.import("blots/container"),Y=n.import("parchment");class V extends U{static create(e){var t=super.create();return t.dataset.rowId=e,t}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.dataset.rowId===this.domNode.dataset.rowId&&(e.moveChildren(this),e.remove())}get rowId(){return this.domNode.dataset.rowId}foreachCellInner(e){for(var r,o=this.children.iterator(),a=0;r=o();){if(e(t(r.descendants(j),1)[0],a++))break}}}V.blotName=v,V.tagName="tr",V.className="ql-table-row",V.scope=Y.Scope.BLOCK_BLOT;var $=n.import("blots/container"),J=n.import("parchment");class Q extends ${constructor(e,t){super(e,t),this.formatTableWidth()}static create(e){var t=super.create();return t.dataset.tableId=e,t.classList.add("ql-table"),t.setAttribute("cellpadding",0),t.setAttribute("cellspacing",0),t}colWidthFillTable(){if(!this.full){var e=this.children.head;if(e&&e.statics.blotName===u){var t=e.children.reduce(((e,t)=>t.width+e),0);return 0===t||isNaN(t)||this.full?null:(this.domNode.style.width=t+"px",t)}}}formatTableWidth(){setTimeout((()=>{this.colWidthFillTable()}),0)}get tableId(){return this.domNode.dataset.tableId}get full(){return this.domNode.hasAttribute("data-full")}set full(e){this.domNode[e?"setAttribute":"removeAttribute"]("data-full","")}getRows(){return this.descendants(V)}getRowIds(){return this.getRows().map((e=>e.rowId))}getCols(){return this.descendants(F)}getColIds(){return this.getCols().map((e=>e.colId))}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&e.domNode.dataset.tableId===this.domNode.dataset.tableId&&(e.moveChildren(this),e.remove())}}Q.blotName=h,Q.tagName="table",Q.scope=J.Scope.BLOCK_BLOT;var Z=n.import("blots/container"),ee=n.import("parchment");class te extends Z{static create(e){var t=super.create();return t.dataset.tableId=e,t.addEventListener("dragstart",(e=>{e.preventDefault(),e.stopPropagation()}),!0),t.ondrop=e=>{e.preventDefault()},t.ondragover=e=>{e.preventDefault(),e.dataTransfer.dropEffect="none"},t}get tableId(){return this.domNode.dataset.tableId}insertBefore(e,t){e.statics.blotName==this.statics.blotName?super.insertBefore(e.children.head,t):this.statics.allowedChildren.find((t=>t.blotName===e.statics.blotName))?super.insertBefore(e,t):t?this.prev?this.prev.insertBefore(e,null):this.parent.insertBefore(e,this):this.next?this.next.insertBefore(e,t):this.parent.appendChild(e)}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&e.domNode.dataset.tableId===this.domNode.dataset.tableId&&(e.moveChildren(this),e.remove())}deleteAt(e,t){var r;super.deleteAt(e,t),null===(r=document.querySelector('.ql-table-tooltip[data-table-id="'.concat(this.tableId,'"]')))||void 0===r||null===(r=r.classList)||void 0===r||r.add("ql-hidden")}}te.blotName=c,te.tagName="p",te.className="ql-table-wrapper",te.scope=ee.Scope.BLOCK_BLOT;var re=n.import("parchment"),oe=n.import("formats/list/item");class ae extends oe{replaceWith(e,t){if(this.parent.isolate(this.offset(this.parent),this.length()),e===this.parent.statics.blotName)return this.parent.replaceWith(e,t),this;if(e===f){var r="string"==typeof e?re.create(e,t):e;return r.replace(this.parent),this.attributes.copy(r),r}return super.replaceWith(e,t)}}var ie="#0589f3";class le{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return null;this.table=e,this.quill=t,this.options=r,this.optionsMerge(),this.boundary={},this.selectedTds=[],this.dragging=!1,this.selectingHandler=this.mouseDownHandler.bind(this),this.cellSelect=null,this.scrollHandler=[],this.helpLinesInitial(),new ResizeObserver((e=>{this.clearSelection()})).observe(this.quill.root),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.closeHandler=this.clearSelection.bind(this),this.quill.on(n.events.TEXT_CHANGE,this.closeHandler)}optionsMerge(){var e;(null===(e=this.options)||void 0===e?void 0:e.primaryColor)&&(ie=this.options.primaryColor)}addScrollEvent(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}clearScrollEvent(){for(var e=0;e<this.scrollHandler.length;e++){var r=t(this.scrollHandler[e],2),o=r[0],a=r[1];o.removeEventListener("scroll",a)}this.scrollHandler=[]}helpLinesInitial(){this.cellSelect=this.quill.addContainer("ql-table-selection_line"),T(this.cellSelect,{"border-color":ie})}mouseDownHandler(e){if(0===e.button&&e.target.closest(".ql-table")){var t=e.target.closest(".ql-table").dataset.tableId,r=e=>{if(0===e.button&&e.target.closest(".ql-table")&&e.target.closest(".ql-table").dataset.tableId===t){var r=e.target.closest("td[data-row-id]"),o=L(r.getBoundingClientRect(),this.quill.root.parentNode);this.boundary=E(i,o),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(),this.repositionHelpLines(),a!==r&&this.quill.blur()}},o=e=>{document.body.removeEventListener("mousemove",r,!1),document.body.removeEventListener("mouseup",o,!1),this.dragging=!1};document.body.addEventListener("mousemove",r,!1),document.body.addEventListener("mouseup",o,!1);var a=e.target.closest("td[data-row-id]"),i=L(a.getBoundingClientRect(),this.quill.root.parentNode);this.dragging=!0,this.boundary=E(i,i),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(),this.repositionHelpLines(),this.addScrollEvent(this.table.parentNode,(()=>{this.repositionHelpLines()}));var l=()=>{this.clearSelection(),this.quill.root.removeEventListener("scroll",l)};this.quill.root.addEventListener("scroll",l)}}computeSelectedTds(){return n.find(this.table).descendants(W).reduce(((e,t)=>{var r=L(t.domNode.getBoundingClientRect(),this.quill.root.parentNode),o=r.x,a=r.y,i=r.width,l=r.height;return o+2>=this.boundary.x&&o-2+i<=this.boundary.x1&&a+2>=this.boundary.y&&a-2+l<=this.boundary.y1&&e.push(t.getCellInner()),e}),[])}correctBoundary(){n.find(this.table).descendants(W).forEach((e=>{var t=L(e.domNode.getBoundingClientRect(),this.quill.root.parentNode),r=t.x,o=t.y,a=t.width,i=t.height;(r+2>=this.boundary.x&&r+2<=this.boundary.x1||r-2+a>=this.boundary.x&&r-2+a<=this.boundary.x1)&&(o+2>=this.boundary.y&&o+2<=this.boundary.y1||o-2+i>=this.boundary.y&&o-2+i<=this.boundary.y1)&&(this.boundary=E(this.boundary,{x:r,y:o,width:a,height:i}))})),this.scrollX=this.table.parentNode.scrollLeft}repositionHelpLines(){var e=this.table.parentNode.scrollLeft,t=this.quill.root.parentNode.scrollTop;T(this.cellSelect,{display:"block",left:"".concat(this.boundary.x+(this.scrollX-e)-1,"px"),top:"".concat(2*t+this.boundary.y,"px"),width:"".concat(this.boundary.width+1,"px"),height:"".concat(this.boundary.height+1,"px")})}clearSelection(){this.boundary={},this.selectedTds=[],this.cellSelect&&T(this.cellSelect,{display:"none"}),this.clearScrollEvent()}destroy(){return this.clearSelection(),this.cellSelect.remove(),this.cellSelect=null,this.clearScrollEvent(),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),this.quill.off(n.events.TEXT_CHANGE,this.closeHandler),null}}var ne=12;class se{constructor(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,"position",(()=>{var e=L(this.table.domNode.getBoundingClientRect(),this.quill.root),t=this.table.domNode.offsetTop,r=this.quill.root.scrollTop;T(this.root,{top:"".concat(t-r-ne,"px"),left:e.x+"px"})})),this.quill=t,this.options=r,this.optionsMerge(),this.tableDisableToolHandlers={},this.tableWrapper=null,this.table=null,this.curTableId="",this.focusTableChange=!1,this.tableCols=[],this.scrollHandler=[],this.root=this.quill.addContainer("ql-table-tooltip"),this.root.style.height=ne+"px",new ResizeObserver((e=>{this.hide(),this.focusTableChange=!0,this.curTableId=""})).observe(this.quill.root),this.isMobile="ontouchstart"in window,this.handledEvents=this.isMobile?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"},this.hide(),this.listen()}optionsMerge(){var e,t;(null===(e=this.options)||void 0===e?void 0:e.tipHeight)&&(ne=this.options.tipHeight),se.disableToolNames=Array.from(new Set([...se.disableToolNames,...(null===(t=this.options)||void 0===t?void 0:t.disableToolNames)||[]]))}listen(){this.quill.on(n.events.EDITOR_CHANGE,(e=>{if(e===n.events.TEXT_CHANGE)return this.hide();var r=this.quill.getSelection();if(null==r)return this.hide(),void this.enableFromTable();var o=t(this.quill.scroll.descendant(te,r.index),1)[0];if(null!==o){var a;this.disableFromTable(),this.tableWrapper=o,this.table=o.children.head;for(var i=o.children.tail;i&&i.statics.blotName!==m;){var l;i=null===(l=i.children)||void 0===l?void 0:l.tail}var s=null===(a=o.children.head)||void 0===a||null===(a=a.children)||void 0===a?void 0:a.head;s.statics.blotName===u&&s.children.length?this.tableCols=s.children.map((e=>e)):this.tableCols=[];var d=o.children.head.tableId;return this.curTableId!==d&&(this.clearScrollEvent(),this.focusTableChange=!0,this.addScrollEvent(this.tableWrapper.domNode,this.scrollSync.bind(this,this.tableWrapper.domNode))),this.curTableId=d,this.show(),void this.position()}this.enableFromTable(),this.hide()}))}disableFromTable(){this.toggleDisableToolbarTools("add");var e=this.quill.getModule("toolbar");if(!e.disableByTable){e.disableByTable=!0;var t,o=function(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=r(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,n=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return n=e.done,e},e:function(e){s=!0,l=e},f:function(){try{n||null==o.return||o.return()}finally{if(s)throw l}}}}(se.disableToolNames);try{for(o.s();!(t=o.n()).done;){var a=t.value;this.tableDisableToolHandlers[a]=e.handlers[a],e.handlers[a]=()=>{}}}catch(e){o.e(e)}finally{o.f()}}}enableFromTable(){this.toggleDisableToolbarTools("remove");var e=this.quill.getModule("toolbar");for(var t in this.tableDisableToolHandlers)e.handlers[t]=this.tableDisableToolHandlers[t];this.tableDisableToolHandlers={},e.disableByTable=!1}toggleDisableToolbarTools(e){var r=this.quill.getModule("toolbar");r.controls.map((o=>{var a,i=t(o,2),l=i[0],n=i[1];se.disableToolNames.includes(l)&&("select"===n.tagName.toLowerCase()?null===(a=r.container.querySelector(".ql-picker.".concat(n.className)))||void 0===a||a.classList[e]("ql-disabled-table"):n.classList[e]("ql-disabled-table"))}))}scrollSync(e,t){this.root.scrollLeft=e.scrollLeft}addScrollEvent(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}clearScrollEvent(){for(var e=0;e<this.scrollHandler.length;e++){var r=t(this.scrollHandler[e],2),o=r[0],a=r[1];o.removeEventListener("scroll",a)}this.scrollHandler=[]}show(){if(this.tableCols.length){if(this.focusTableChange){var e=this.tableWrapper.domNode.getBoundingClientRect();this.root.dataset.tableId=this.tableWrapper.tableId,this.root.innerHTML=[...this.tableCols].map((t=>{var r=t.width+(this.table.full?"%":"px");return t.width||(r=t.domNode.getBoundingClientRect().width+"px"),'<div class="ql-table-col-header" style="width: '.concat(r,'">\n            \t\t\t<div class="ql-table-col-separator" style="height: ').concat(e.height+ne-3,'px"></div>\n            \t\t</div>')})).join(""),this.focusTableChange=!1,Object.assign(this.root.style,{width:e.width+"px"}),this.bindDrag()}setTimeout((()=>{this.scrollSync(this.tableWrapper.domNode)}),0),this.root.classList.remove("ql-hidden");var t=()=>{this.hide(),this.quill.root.removeEventListener("scroll",t)};this.quill.root.addEventListener("scroll",t)}}hide(){this.root.classList.add("ql-hidden")}bindDrag(){var e=null,t=-1,r=Array.from(this.root.getElementsByClassName("ql-table-col-header")),o=Array.from(this.root.getElementsByClassName("ql-table-col-separator")),a=document.body,i=o=>{var a=r[t].getBoundingClientRect(),i=this.table.domNode.getBoundingClientRect().width,l=this.isMobile?o.changedTouches[0].clientX:o.clientX;if(this.table.full){var n=.03*i,s=l>a.right?r[t+1]?r[t+1].getBoundingClientRect().right-n:a.right-n:1/0,d=a.x+n;l=Math.min(Math.max(l,d),s)}else l-a.x<26&&(l=a.x+26);l=Math.floor(l),e.style.left=l+"px",e.dataset.w=l-a.x},l=o=>{var n=parseInt(e.dataset.w);if(this.table.full){var s=n/this.table.domNode.getBoundingClientRect().width*100,d=this.tableCols[t].width;if(s<d){var c=d-(s=Math.max(3,s));this.tableCols[t+1]?this.tableCols[t+1].width="".concat(this.tableCols[t+1].width+c,"%"):this.tableCols[t-1]?this.tableCols[t-1].width="".concat(this.tableCols[t-1].width+c,"%"):s=100,this.tableCols[t].width="".concat(s,"%")}else if(this.tableCols[t+1]){var h=d+this.tableCols[t+1].width;s=Math.min(h-3,s),this.tableCols[t].width="".concat(s,"%"),this.tableCols[t+1].width="".concat(h-s,"%")}}else this.table.domNode.style.width=parseFloat(this.table.domNode.style.width)-parseFloat(r[t].style.width)+n+"px",r[t].style.width="".concat(n,"px"),this.tableCols[t].width="".concat(n,"px");this.table.formatTableWidth(),a.removeChild(e),e=null,t=-1,document.removeEventListener(this.handledEvents.up,l),document.removeEventListener(this.handledEvents.move,i),this.quill.getModule(w).hideTableTools()},n=(r,o)=>{document.addEventListener(this.handledEvents.up,l),document.addEventListener(this.handledEvents.move,i),t=r;var n=document.createElement("div");n.classList.add("ql-table-drag-line");var s=this.tableWrapper.domNode.getBoundingClientRect();T(n,{top:"".concat(s.y-ne,"px"),left:"".concat(this.isMobile?o.changedTouches[0].clientX:o.clientX,"px"),height:"".concat(s.height+ne,"px")}),a.appendChild(n),e&&a.removeChild(e),e=n};o.map(((e,t)=>{e.addEventListener(this.handledEvents.down,n.bind(this,t)),e.addEventListener("dragstart",(e=>{e.preventDefault()}))}))}}se.disableToolNames=[w];var de='<svg viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm0 5h18M10 3v18"/></svg>',ce=n.import("parchment"),he=n.import("delta"),ue=n.import("blots/block/embed"),pe=n.import("blots/block"),me=n.import("blots/container"),ve=n.import("ui/icons");H.allowedChildren=[pe,ue,me],te.allowedChildren=[Q],Q.allowedChildren=[A,K],Q.requiredContainer=te,A.allowedChildren=[V],A.requiredContainer=Q,K.allowedChildren=[F],K.requiredContainer=Q,V.allowedChildren=[W],V.requiredContainer=A,W.allowedChildren=[j],j.defaultChild="block",n.register({["formats/".concat(H.blotName)]:H,["formats/".concat(j.blotName)]:j,["formats/".concat(W.blotName)]:W,["formats/".concat(V.blotName)]:V,["formats/".concat(A.blotName)]:A,["formats/".concat(Q.blotName)]:Q,["formats/".concat(te.blotName)]:te,["formats/".concat(K.blotName)]:K,["formats/".concat(F.blotName)]:F},!0);class be{constructor(e,r){this.quill=e,this.options=r,this.controlItem=null,this.tableInsertSelectCloseHandler=null;var o=this.quill.getModule("toolbar");if(o){var a=o.controls.find((e=>t(e,1)[0]===be.toolName));if(a){var i;if(this.controlItem=a[1].parentNode.querySelector(".ql-table.ql-picker"),this.controlItem)(null===(i=this.controlItem.getElementsByClassName("ql-picker-label"))||void 0===i?void 0:i[0]).innerHTML=de;else this.controlItem=a[1];this.buildCustomSelect(this.options.customSelect,a[1].tagName.toLowerCase(),this.options.customButton),o.addHandler(be.toolName,this.handleSelectDisplay.bind(this))}}this.pasteTableHandler(),this.quill.root.addEventListener("click",(t=>{var r,o=t.path||t.composedPath&&t.composedPath();if(o&&!(o.length<=0)){var a=null===(r=o.filter((e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("ql-table"))))||void 0===r?void 0:r[0];if(a){if(this.table===a)return;this.table&&this.hideTableTools(),this.showTableTools(a,e,this.options.selection)}else this.table&&this.hideTableTools()}}),!1),this.quill.root.addEventListener("contextmenu",(t=>{var r;if(!this.table)return!0;t.preventDefault();var o=t.path||t.composedPath&&t.composedPath();if(o&&!(o.length<=0)){var a=o.filter((e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("ql-table")))[0];if(a&&null!==(r=this.tableSelection)&&void 0!==r&&null!==(r=r.selectedTds)&&void 0!==r&&r.length){this.tableOperationMenu&&(this.tableOperationMenu=this.tableOperationMenu.destroy());var i=o.filter((e=>e.tagName&&"TR"===e.tagName.toUpperCase()&&e.getAttribute("data-row-id")))[0],l=o.filter((e=>e.tagName&&"TD"===e.tagName.toUpperCase()&&e.getAttribute("data-row-id")))[0];this.tableOperationMenu=new B({table:a,row:i,cell:l,left:t.clientX,top:t.clientY},e,this.options.operationMenu)}}})),this.quill.theme.TableTooltip=new se(this.quill,this.options.tableToolTip)}showTableTools(e,t,r){this.table=e,this.tableSelection=new le(e,t,r)}hideTableTools(){this.tableSelection&&this.tableSelection.destroy(),this.tableOperationMenu&&this.tableOperationMenu.destroy(),this.quill.theme.TableTooltip&&(this.quill.theme.TableTooltip.curTableId=null,this.quill.theme.TableTooltip.hide()),this.tableSelection=null,this.tableOperationMenu=null,this.table=null}pasteTableHandler(){var e=y(),t=y(),r=[],o=0;this.quill.clipboard.addMatcher(h,((t,a)=>{var i,l;if(!a.ops.length)return a;var n,s=!(null===(i=a.ops[0].attributes)||void 0===i||!i.col),d=t.getBoundingClientRect().width,c=this.options.fullWidth;s&&(c=!(null===(l=a.ops[0].insert)||void 0===l||null===(l=l.col)||void 0===l||!l.full));var h=c?Math.max(100/r.length,3)+"%":Math.max(d/r.length,26)+"px";if(s)for(var u=0;u<a.ops.length&&a.ops[u].attributes[p];u++)Object.assign(a.ops[u].attributes[p],{tableId:e,colId:r[u],full:c,width:a.ops[u].attributes[p].width?parseFloat(a.ops[u].attributes[p].width)+(c?"%":"px"):h});else n=r.reduce(((t,r)=>(t.insert("\n",{[p]:{colId:r,tableId:e,width:h,full:c}}),t)),new he);return e=y(),r=[],o=0,n?n.concat(a):a})),this.quill.clipboard.addMatcher(v,((e,r)=>(t=y(),o=0,r))),this.quill.clipboard.addMatcher(b,((a,i)=>{var l,n=a.getAttribute("rowspan")||1,s=a.getAttribute("colspan")||1,d=+o+ +s-1;if(!r[d])for(var c=d;c>=0;c--)r[c]||(r[c]=y());var h=r[d];return o+=1,"\n"!==(null===(l=i.slice(i.length()-1).ops[0])||void 0===l?void 0:l.insert)&&i.insert("\n"),i.compose((new he).retain(i.length(),{[f]:{tableId:e,rowId:t,colId:h,rowspan:n,colspan:s,style:a.getAttribute("style")}}))}))}buildCustomSelect(e,t,r){var o=this;return l(a().mark((function i(){var l,n,d;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((l=document.createElement("div")).classList.add("ql-custom-select"),!e||!S(e)){a.next=8;break}return a.next=5,e();case 5:a.t0=a.sent,a.next=9;break;case 8:a.t0=o.createSelect(r);case 9:if(n=a.t0,l.appendChild(n),d=o.controlItem,"select"===t&&(d=o.controlItem.querySelector(".ql-picker-options")),d){a.next=15;break}return a.abrupt("return");case 15:n.addEventListener(s,(e=>{var t=e.detail,r=t.row,a=t.col;r&&a&&o.insertTable(r,a)})),d.appendChild(l);case 17:case"end":return a.stop()}}),i)})))()}handleSelectDisplay(){var e=this;return l(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.controlItem.classList.add("ql-expanded"),e.controlItem.dataset.active=!0,window.removeEventListener("click",e.tableInsertSelectCloseHandler),e.tableInsertSelectCloseHandler=t=>{var r=(t.composedPath&&t.composedPath()||t.path).findIndex((t=>t===e.controlItem));(r>2||-1===r)&&e.closeSelecte()},window.addEventListener("click",e.tableInsertSelectCloseHandler);case 5:case"end":return t.stop()}}),t)})))()}createSelect(e){return(e=>{var t=document.createElement("div");t.classList.add("create_select");var r=document.createElement("div");r.classList.add("create_select_block");for(var o=0;o<8;o++)for(var a=0;a<8;a++){var i=document.createElement("div");i.classList.add("create_select_block_item"),i.dataset.row=o+1,i.dataset.col=a+1,r.appendChild(i)}var l=document.createElement("div");l.classList.add("create_select_custom"),l.innerText=e||"自定义行列数",t.appendChild(r),t.appendChild(l);var n=e=>{var r=e.row,o=e.col;t.dispatchEvent(new CustomEvent(s,{detail:{row:Number(r),col:Number(o)}}))},d=()=>{var e=t.dataset,o=e.row,a=e.col;if([].forEach.call(r.querySelectorAll(".active"),(e=>{e.classList.remove("active")})),o&&a)for(var i=Array.from(r.children),l=0;l<i.length;l++){if(i[l].dataset.row>o&&i[l].dataset.col>a)return;i[l].dataset.row<=o&&i[l].dataset.col<=a?i[l].classList.add("active"):i[l].classList.remove("active")}};return r.addEventListener("mousemove",(e=>{var r=e.target.dataset,o=r.row,a=r.col;o&&a&&(t.dataset.row=o,t.dataset.col=a,d())})),r.addEventListener("mouseleave",(e=>{t.removeAttribute("data-row"),t.removeAttribute("data-col"),d()})),r.addEventListener("click",(()=>{var e=t.dataset,r=e.row,o=e.col;r&&o&&n({row:r,col:o})})),l.addEventListener("click",(()=>{x().then((e=>{var t=e.row,r=e.col;n({row:t,col:r})}))})),t})(e)}closeSelecte(){this.controlItem.classList.remove("ql-expanded"),this.controlItem.dataset.active=!1,window.removeEventListener("click",this.tableInsertSelectCloseHandler)}insertTable(e,t){if(e>=100||t>=100)throw new Error("Both rows and columns must be less than 100.");this.quill.focus(),this.range=this.quill.getSelection();var r=this.range;if(null!=r){var o=this.quill.getLeaf(r.index)[0];if(we(o))throw new Error("Not supported nesting of "+o.type+" type object within a table.");setTimeout((()=>{var o=(new he).retain(r.index);o.insert("\n");var a=y(),i=new Array(t).fill(0).map((()=>y())),l=getComputedStyle(this.quill.root),s=l.width,d=l.paddingLeft,c=l.paddingRight;s=parseInt(s),d=parseInt(d),c=parseInt(c),s=s-d-c,o=new Array(t).fill("\n").reduce(((e,r,o)=>(e.insert(r,{[p]:{width:this.options.fullWidth?"".concat(1/t*100,"%"):"".concat(Math.floor(s/t),"px"),tableId:a,colId:i[o],full:this.options.fullWidth}}),e)),o),o=new Array(e).fill(0).reduce((e=>{var r=y();return new Array(t).fill("\n").reduce(((e,t,o)=>(e.insert(t,{[f]:{tableId:a,rowId:r,colId:i[o],rowspan:1,colspan:1}}),e)),e)}),o),this.quill.updateContents(o,n.sources.USER),this.quill.setSelection(r.index+t+t*e+1,n.sources.API),this.quill.focus(),this.closeSelecte()}),0)}}findTable(e){for(var t=e;t.statics.blotName!==h&&null!==t;)t=t.parent;return t}appendRow(e){var t=this.tableSelection.selectedTds;if(t.length){var r=this.findTable(t[0]),o=t[e?t.length-1:0],a=n.find(o.domNode.parentNode.parentNode);if(e)for(var i=o.rowspan;i>1;)a=a.next,i-=1;var l=r.getColIds(),s=new Set(l),d=e?a:a.prev,c=new Array,h=0;for(d||(s.clear(),c=l);s.size&&(h+=1,d);)d.foreachCellInner((e=>{if(s.has(e.colId)){var t=[e.colId];if(e.colspan>1){var r=l.findIndex((t=>t===e.colId));-1===r&&(r=0),t=l.slice(r,r+e.colspan)}e.rowspan>h?e.rowspan+=1:c.push(...t),t.map((e=>s.delete(e)))}})),d=d.prev;for(var u=r.tableId,p=y(),m=ce.create(v,p),g=new Set(c),w=0;w<l.length&&g.size;w++)if(g.has(l[w])){var N=ce.create(b,{rowId:p,colId:l[w],rowspan:1,colspan:1}),I=ce.create(f,{tableId:u,rowId:p,colId:l[w],rowspan:1,colspan:1}),C=ce.create("block");C.appendChild(ce.create("break")),I.appendChild(C),N.appendChild(I),m.appendChild(N),g.delete(l[w])}a.parent.insertBefore(m,e?a.next:a)}}removeRow(){if(this.tableSelection.selectedTds.length){var e=this.tableSelection.selectedTds,r=e.reduce(((e,t)=>(e[0].has(t.rowId)||(e[0].add(t.rowId),e[1].push(t.parent.parent)),e)),[new Set,[]]),o=t(r,2),a=o[0],i=o[1];a=Array.from(a);var l=new Map;i.map((e=>{e.foreachCellInner((e=>{var t=a.findIndex((t=>t===e.rowId));e.rowspan>a.length-t&&l.set(e.colId,{cell:e,rowspan:e.rowspan-a.length+t})})),e.remove()}));var s=this.findTable(e[0]),d=s.tableId;if(l.size)for(var c=i[i.length-1].next,h=s.getColIds(),u=null,p=0;p<h.length;){var m=c.domNode.querySelector('td[data-col-id="'.concat(h[p],'"]'));if(m){var v=n.find(m);p+=v.colspan,u=v.next}else{var g=l.get(h[p]),w=g.cell,y=g.rowspan,N=ce.create(b,{rowId:c.rowId,colId:h[p],rowspan:y,colspan:w.colspan}),I=ce.create(f,{tableId:d,rowId:c.rowId,colId:h[p],rowspan:y,colspan:w.colspan});w.moveChildren(I),N.appendChild(I),c.insertBefore(N,u),p+=w.colspan}}}}appendCol(e){if(this.tableSelection.selectedTds.length){var t,r=this.tableSelection.selectedTds,o=this.findTable(r[0]),a=o.getCols(),i=o.getColIds(),l=o.getRows(),n=y();if(e){var s=r[r.length-1],d=i.findIndex((e=>e===s.colId));t=i[d+s.colspan-1]}else t=r[0].colId;var c=a.findIndex((r=>{if(r.colId===t){var a=ce.create(p,{width:this.options.fullWidth?"6%":"160px",full:this.options.fullWidth,tableId:o.tableId,colId:n}),i=e?r.next:r;r.parent.insertBefore(a,i),this.options.fullWidth&&(i||(i=e?r:r.prev),i.width=Math.max(i.width-6,3)+"%")}return r.colId===t}));o.formatTableWidth();var h=e?c+1:c,u=0;l.map((e=>{var t=!1,r=null;if(e.foreachCellInner((e=>{if(u>0)return u-=1,t=!0,!0;var o=i.findIndex((t=>t===e.colId));return e.colspan+o>h&&(r=e.parent,1!==e.colspan&&o!==h)?(e.colspan+=1,t=!0,u=e.rowspan-1,!0):o>=h||void 0})),!t){var a=ce.create(b,{rowId:e.rowId,colId:n,rowspan:1,colspan:1}),l=ce.create(f,{tableId:o.tableId,rowId:e.rowId,colId:n,rowspan:1,colspan:1});a.appendChild(l),e.insertBefore(a,r)}}))}}removeCol(){if(this.tableSelection.selectedTds.length){var e=this.tableSelection.selectedTds,r=this.findTable(this.tableSelection.selectedTds[0]),o=r.getColIds(),a=e.reduce(((e,t)=>{var r=o.findIndex((e=>e===t.colId));return[Math.min(e[0],r),Math.max(e[1],r+t.colspan-1)]}),[1/0,-1/0]),i=t(a,2),l=i[0],n=i[1];r.getRows().map((e=>{var t=0;e.foreachCellInner((e=>{if(t>n)return!0;var r=e.colspan;t+r-1>n?e.colspan-=n-Math.max(t,l)+1:t<l&&t+r-1>=l?e.colspan-=t+r-l:t>=l&&e.remove(),t+=r}))}));for(var s=r.getCols(),d=0;d<s.length&&(d>=l&&d<=n&&s[d].remove(),!(d>n));d++);r.formatTableWidth()}}removeTable(){var e=this.tableSelection.selectedTds;e.length&&this.findTable(e[0]).remove()}mergeCells(){if(this.tableSelection.selectedTds.length){var e=this.tableSelection.selectedTds,t=e.reduce(((e,t)=>{var r=t.colId;e[0][r]||(e[0][r]=0),e[0][r]+=t.rowspan;var o=t.rowId;return e[1][o]||(e[1][o]=0),e[1][o]+=t.colspan,e}),[{},{}]),r=Math.max(...Object.values(t[0])),o=Math.max(...Object.values(t[1])),a=e[0].clone();e[0].parent.appendChild(a),a.colspan=o,a.rowspan=r;for(var i=0;i<e.length;i++)e[i].moveChildren(a),e[i].remove();var l=this.findTable(e[0]);if(l.getColIds().length===o&&(a.rowspan=1),l.getRowIds().length<=r){for(var n=l.descendants(F),s=a.colspan-1,d=null,c=0;c<n.length&&!(s<=0);c++)null!==d&&(null===n[d].width||null===n[c].width?n[d].width=null:n[d].width+=n[c].width,n[c].remove(),s-=1),n[c].colId===a.colId&&(d=c);a.colspan=1}}}setStyle(e,t){t.length&&t.map((t=>t.style=e))}}var fe=[b],ge=e=>fe.includes(e.statics.blotName),we=e=>!(!e||!e.parent)&&(!!ge(e.parent)||we(e.parent));be.moduleName=g,be.toolName=w,be.createEventName=s,ve[be.toolName]=de;var ye=()=>n.register({"formats/list/item":ae},!0);export{ae as ListItemRewrite,be as default,we as isForbidInTable,ge as isForbidInTableBlot,ye as rewirteFormats,fe as tableCantInsert};
//# sourceMappingURL=index.js.map
